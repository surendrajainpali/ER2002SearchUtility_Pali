<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ñ‡•ã‡§ú ‡§Ø‡•Ç‡§ü‡§ø‡§≤‡§ø‡§ü‡•Ä</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background-color: #ffffff;
      color: #000000;
    }

    h2 {
      background-color: #ffffff;
      color: #0077cc;
      padding: 12px;
      border-radius: 6px;
      text-align: center;
      border: 1px solid #ccc;
    }

    select, input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    tr:nth-child(even) {
      background-color: #fafafa;
    }

    #status {
      font-size: 14px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    #status.loading {
      color: #cc0000;
    }

    #status.loaded {
      color: #006400;
    }

    #pagination {
      margin-top: 20px;
      text-align: center;
    }

    #pagination button {
      padding: 6px 12px;
      margin: 0 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<h2>üîç ‡§∏‡§Ç‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ñ‡•ã‡§ú ‡§Ø‡•Ç‡§ü‡§ø‡§≤‡§ø‡§ü‡•Ä</h2>
<p id="status">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>

<select id="acSelect">
  <option value="all">‡§∏‡§≠‡•Ä ‡§µ‡§ø‡§ß‡§æ‡§®‡§∏‡§≠‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞</option>
  <option value="117-‡§∏‡•ã‡§ú‡§§">117-‡§∏‡•ã‡§ú‡§§</option>
  <option value="118-‡§™‡§æ‡§≤‡•Ä">118-‡§™‡§æ‡§≤‡•Ä</option>
  <option value="119-‡§Æ‡§æ‡§∞‡§µ‡§æ‡•ú ‡§ú‡§Ç‡§ï‡•ç‡§∂‡§®">119-‡§Æ‡§æ‡§∞‡§µ‡§æ‡•ú ‡§ú‡§Ç‡§ï‡•ç‡§∂‡§®</option>
  <option value="120-‡§¨‡§æ‡§≤‡•Ä">120-‡§¨‡§æ‡§≤‡•Ä</option>
  <option value="121-‡§∏‡•Å‡§Æ‡•á‡§∞‡§™‡•Å‡§∞">121-‡§∏‡•Å‡§Æ‡•á‡§∞‡§™‡•Å‡§∞</option>
</select>

<input type="text" id="oldAcInput" placeholder="Old AC No.">
<input type="text" id="partNoInput" placeholder="Part No.">
<input type="text" id="searchBox" placeholder="‡§®‡§æ‡§Æ, ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ EPIC..." disabled />

<table id="resultsTable">
  <thead>
    <tr>
      <th>Old AC No.</th>
      <th>Part No.</th>
      <th>S. NO.</th>
      <th>H. NO.</th>
      <th>Name</th>
      <th>Relative Name</th>
      <th>Age</th>
      <th>EPIC</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="pagination"></div>

<script>
  const statusEl = document.getElementById('status');
  const acSelect = document.getElementById('acSelect');
  const searchBox = document.getElementById('searchBox');
  const oldAcInput = document.getElementById('oldAcInput');
  const partNoInput = document.getElementById('partNoInput');
  const tableBody = document.querySelector('#resultsTable tbody');
  const pagination = document.getElementById('pagination');

  const acChunkMap = {
    "117-‡§∏‡•ã‡§ú‡§§": 12,
    "118-‡§™‡§æ‡§≤‡•Ä": 9,
    "119-‡§Æ‡§æ‡§∞‡§µ‡§æ‡•ú ‡§ú‡§Ç‡§ï‡•ç‡§∂‡§®": 10,
    "120-‡§¨‡§æ‡§≤‡•Ä": 12,
    "121-‡§∏‡•Å‡§Æ‡•á‡§∞‡§™‡•Å‡§∞": 11
  };

  let allData = [];
  let data = [];
  let filtered = [];
  let currentPage = 1;
  const resultsPerPage = 20;

  function normalize(value) {
    return value !== undefined && value !== null
      ? String(value).replace(/\s+/g, ' ').trim().toLowerCase()
      : '';
  }

  async function fetchChunks(acName, count) {
    const promises = [];
    for (let i = 1; i <= count; i++) {
      const path = `data/${acName}/data${i}.json`;
      promises.push(fetch(path).then(r => r.ok ? r.json() : []).catch(() => []));
    }
    const results = await Promise.allSettled(promises);
    return results.filter(r => r.status === 'fulfilled').flatMap(r => r.value);
  }

  async function loadAllData() {
    statusEl.textContent = '‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';
    statusEl.classList.add('loading');
    const allPromises = Object.entries(acChunkMap).map(([ac, count]) => fetchChunks(ac, count));
    const allResults = await Promise.all(allPromises);
    allData = allResults.flat();
    data = allData;
    filtered = data;
    searchBox.disabled = false;
    filterData();
    renderPage();
    statusEl.textContent = `‚úÖ ‡§ï‡•Å‡§≤ ${data.length} ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•Å‡§è`;
    statusEl.classList.remove('loading');
    statusEl.classList.add('loaded');
  }

  async function loadSelectedAC(acName) {
    statusEl.textContent = `${acName} ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...`;
    statusEl.classList.add('loading');
    const count = acChunkMap[acName];
    data = await fetchChunks(acName, count);
    filtered = data;
    currentPage = 1;
    filterData();
    renderPage();
    statusEl.textContent = `‚úÖ ${acName} ‡§∏‡•á ${data.length} ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•Å‡§è`;
    statusEl.classList.remove('loading');
    statusEl.classList.add('loaded');
  }

  acSelect.addEventListener('change', () => {
    const selected = acSelect.value;
    if (selected === 'all') {
      data = allData;
      filtered = data;
      currentPage = 1;
      filterData();
      renderPage();
      statusEl.textContent = `‚úÖ ‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡•ã‡§Ç ‡§∏‡•á ${data.length} ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•Å‡§è`;
    } else {
      loadSelectedAC(selected);
    }
  });

  function filterData() {
    const nameQuery = normalize(searchBox.value);
    const oldAcQuery = normalize(oldAcInput.value);
    const partNoQuery = normalize(partNoInput.value);

    filtered = data.filter(row => {
      const rowOldAc = normalize(row['Old AC No.']);
      const rowPartNo = normalize(row['Part No.']);
      const rowName = normalize(row['Name']);
      const rowRelative = normalize(row['Relative Name']);
      const rowEpic = normalize(row['EPIC']);

      const matchName =
        rowName.includes(nameQuery) ||
        rowRelative.includes(nameQuery) ||
        rowEpic.includes(nameQuery);

      const matchOldAc = oldAcQuery === '' || rowOldAc === oldAcQuery;
      const matchPartNo = partNoQuery === '' || rowPartNo === partNoQuery;

      if (nameQuery === '' && oldAcQuery === '' && partNoQuery === '') return true;
      if (nameQuery !== '' && oldAcQuery === '' && partNoQuery === '') return matchName;
      if (nameQuery === '' && (oldAcQuery !== '' || partNoQuery !== '')) return matchOldAc && matchPartNo;
      return matchName && matchOldAc && matchPartNo;
    });
  }

  function renderPage() {
    tableBody.innerHTML = '';
    const start = (currentPage - 1) * resultsPerPage;
    const end = start + resultsPerPage;
    const pageData = filtered.slice(start, end);

    if (pageData.length === 0) {
      tableBody.innerHTML = '<tr><td colspan="8">‡§ï‡•ã‡§à ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</td></tr>';
      pagination.innerHTML = '';
      return;
    }

    pageData.forEach(row => {
      const tr = document.createElement('tr');
      ['Old AC No.', 'Part No.', 'S. NO.', 'H. NO.', 'Name', 'Relative Name', 'Age', 'EPIC'].forEach(key => {
        const td = document.createElement('td');
        td.textContent = row[key] || '';
        tr.appendChild(td);
      });
      tableBody.appendChild(tr);
    });

    updatePaginationControls();
  }

  function updatePaginationControls() {
    pagination.innerHTML = '';
    const totalPages = Math.ceil(filtered.length / resultsPerPage);
    if (totalPages <= 1) return;

    const prevBtn = document.createElement('button');
    prevBtn.textContent = '‚¨ÖÔ∏è ‡§™‡§ø‡§õ‡§≤‡§æ';
    prevBtn.disabled = currentPage === 1;
    prevBtn.onclick = () => {
      currentPage--;
      renderPage();
    };

    const nextBtn = document.createElement('button');
    nextBtn.textContent = '‚û°Ô∏è ‡§Ö‡§ó‡§≤‡§æ';
    nextBtn.disabled = currentPage === totalPages;
<!-- ... [everything before remains unchanged] ... -->

    const nextBtn = document.createElement('button');
    nextBtn.textContent = '‚û°Ô∏è ‡§Ö‡§ó‡§≤‡§æ';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.onclick = () => {
      currentPage++;
      renderPage();
    };

    pagination.appendChild(prevBtn);
    pagination.appendChild(document.createTextNode(` ‡§™‡•á‡§ú ${currentPage} / ${totalPages} `));
    pagination.appendChild(nextBtn);
  }

  function triggerSearch() {
    currentPage = 1;
    filterData();
    renderPage();
  }

  searchBox.addEventListener('input', () => {
    clearTimeout(window.debounceTimer);
    window.debounceTimer = setTimeout(triggerSearch, 300);
  });

  oldAcInput.addEventListener('input', triggerSearch);
  partNoInput.addEventListener('input', triggerSearch);

  // Initial load
  loadAllData();
</script>

</body>
</html>
